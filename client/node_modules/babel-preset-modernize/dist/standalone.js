var e=({types:e})=>({name:"transform-implicit-strict",visitor:{Directive(t){const n=t.node.value;e.isDirectiveLiteral(n)&&"use strict"===n.value&&t.remove()}}});const t=["Object.assign","Object.create","Object.define","Object.hasOwnProperty","Object.getOwnProperties","Object.setPrototypeOf","Object.getPrototypeOf","Object.getOwnPropertyDescriptor","Object.getOwnPropertyDescriptors","Object.getOwnPropertySymbols","Object.keys","Array.from","Symbol","Symbol.for","WeakMap","WeakSet","Map","Set","Promise","Promise.all","Promise.resolve","Promise.reject","fetch","Headers","Response","Request","FormData","ArrayBuffer","FileReader","URLSearchParams","URL","JSON","JSON.parse","JSON.stringify","Function.toString","setTimeout","clearTimeout","setInterval","clearInterval","Number.isFinite","Math","Math.max","Math.min","Math.ceil","Math.floor"];function n({types:e,template:n}){function r(t,n,o){if(e.isMemberExpression(t)){let o=t.get("object").resolve();if(e.isIdentifier(o)&&/^(window|global|self|globalThis)$/.test(o.node.name)&&!o.scope.hasBinding(o.node.name,!0))return r(t.get("property"),n,!0)}const i=function t(n){if(e.isMemberExpression(n))return t(n.get("object"))+"."+t(n.get("property"));if(!(n=n.resolve()).node)return;if(!e.isIdentifier(n))return;const r=n.evaluate();return r.confident?("object"==typeof r.value&&console.error("Path evaluated to a non-primitive value: ",r.value),String(r.value)):n.node.name}(t);if(!i)return!1;for(let r of n)if(i.match(r)){const n=(e.isMemberExpression(t)?t.get("object"):t).resolve();return!1!==o&&n.node&&n.scope.hasBinding(n.node.name,!0)?(console.warn("Tainted polyfill identifier "+i),!1):i}return!1}function o(n){if(!e.isLogicalExpression(n)||"||"!==n.node.operator)return;const o=n.get("left");return r(o,t)?(n.replaceWith(e.clone(o.node)),o.node):void 0}function i(t,n){const r=t.resolve(),o=r.scope.getBinding(r.node.name);o?(o.referencePaths.forEach(t=>{if("function"==typeof n)n(t);else{if(e.isExportSpecifier(t.parent))return;o.dereference(),t.replaceWith(e.clone(n))}}),o.references?console.log(`Failed to remove ${o.identifier.name} due: ${o.references} unremovable bindings`):o.path.remove()):console.warn("Unknown binding: ",r)}const s=[["alternate","consequent"],["left","right"]];let a;return{name:"transform-remove-polyfills",visitor:a={Identifier(e){},LogicalExpression(n){const o=n.node.operator,i=n.get("left"),s=n.get("right");let a=r(i,t);if((a||(a=i.evaluateTruthy(),void 0!==a))&&a){let t;"&&"===o?t=s.node:"||"===o&&(t=i.node),t&&n.replaceWith(e.clone(t))}},BinaryExpression(n){const o=n.node.operator,i=n.get("left"),s=n.get("right");if((e.isIdentifier(i)||e.isMemberExpression(i))&&(e.isIdentifier(s)||e.isMemberExpression(s))){const a=r(i,t),l=r(s,t);if(a&&a===l){if("=="===o||"==="===o)return void n.replaceWith(e.booleanLiteral(!0));if("!="===o||"!=="===o)return void n.replaceWith(e.booleanLiteral(!1))}}},CallExpression(t){const r=t.get("callee").resolve();if(e.isIdentifier(r)&&"Function"===r.node.name){const r=function(t){const r=(t=t.slice()).pop();if(!e.isStringLiteral(r.node))return;const o=n.ast("{"+r.node.value+"}");return e.functionExpression(null,t,o)}(t.get("arguments"));r&&(t.replaceWith(r),e.isCallExpression(t.parentPath)&&1===r.body.body.length&&e.isReturnStatement(r.body.body[0])&&e.isThisExpression(r.body.body[0].argument)&&t.parentPath.replaceWith(e.nullLiteral()))}},MemberExpression(e){},UnaryExpression(n){n.node.prefix&&"typeof"===n.node.operator&&r(n.get("argument"),t)&&function n(o,i){const l=o.parentPath,c=!(e.isBooleanLiteral(i)&&!i.value||e.isNullLiteral(i)||e.isIdentifier(i)&&"undefined"===i.name||e.isUnaryExpression(i)&&"void"===i.operator)&&(!i.evaluateTruthy||i.evaluateTruthy());if(e.isLogicalExpression(l)){if("right"===o.key)return l;let t;switch(l.node.operator){case"&&":t=c?e.clone(o.getOpposite().node):e.booleanLiteral(!1);break;case"||":t=e.clone(c?o.node:o.getOpposite().node);break;default:console.error("Unknown operator "+l.node.operator,l.getSource())}return l.replaceWith(t),n(l,t)||l}if(e.isConditionalExpression(l)){const t=c?"consequent":"alternate",r=e.clone(l.get(t).node);return l.get(function(e){for(const t of s){if(t[0]===e)return t[1];if(t[1]===e)return t[0]}}(t)).replaceWith(e.nullLiteral()),l.replaceWith(r),n(l,r)||l}if(e.isUnaryExpression(l)&&l.node.prefix&&"typeof"===l.node.operator&&r(o,t)&&(console.log("unary --\x3e polyfill",l.node),e.isBinaryExpression(l.parentPath))){const t=l.getOpposite().evaluate();if(t.confident){let r="undefined"!==t.value;"!"===l.parent.operator[0]&&(r=!r);const o=e.booleanLiteral(r);return l.parentPath.replaceWith(o),n(l.parentPath,o)}}if(e.isCallExpression(l)){const t=l.get("callee").resolve();if(e.isFunction(t)){const t=function(t,n){const r=t.node,o=t.get("callee").resolve();if(!e.isFunction(o))return{confident:!1};const i=t.node.arguments;t.replaceWith(e.callExpression(e.arrowFunctionExpression(o.node.params,o.node.body),[]));const s=t.get("callee.params");for(let t=s.length;t--;){const n=s[t],r=n.scope.getBinding(n.node.name);r.referencePaths.forEach(n=>{n.replaceWith(i[t]?e.clone(i[t]):n.scope.buildUndefinedNode())}),n.scope.removeBinding(r.name),n.remove()}let l;t.get("callee.body").traverse(a);const c=t.get("callee.body.body").find(t=>e.isReturnStatement(t)),p=t.get("callee.body").scope;p.crawl(),t.get("callee.body.body").length<=1&&0===Object.keys(p.bindings).length&&0===Object.keys(p.globals).length&&(l=c.get("argument"));const d=t.get("callee.body").evaluate();if(t.replaceWith(r),d.confident||(d.confident=!!l,d.value=l),d.confident){const t=o.scope.getBinding(function t(n){const r=n.get("id");if(r&&r.node)return r;const o=n.parentPath;return e.isFunction(o)?t(o):e.isVariableDeclarator(o)?o.get("id"):void 0}(o));t&&(t.dereference(),t.referenced||o.remove())}return d}(l);t&&t.confident&&l.replaceWith(t.value)}}if(e.isReturnStatement(l)&&(console.log("RETURN"),console.log(l.node.argument)),e.isIdentifier(o)&&r(o,t)){const e=o.resolve().node;return o.replaceWith(e),n(o.parentPath,e)}}(n.get("argument"),n.get("argument").node)},AssignmentExpression(e,t){if("="!==e.node.operator)return;const n=o(e.get("right"));n&&i(e.get("left"),n)},VariableDeclarator(e,t){const n=o(e.get("init"));n&&i(e.get("id"),n)},ObjectProperty(t){if(!e.isFunctionExpression(t.get("value"))||t.node.value.id&&!e.isNodesEquivalent(t.node.value.id,t.node.key))t.node.computed||(t.node.shorthand=!0);else{const n=t.node.value,r=e.objectMethod("method",t.node.key,n.params,n.body,t.node.computed);r.async=n.async,r.generator=n.generator,r.decorators=t.node.decorators,t.replaceWith(r)}},DirectiveLiteral(e){"use strict"===e.node.value&&e.parentPath.remove()}}}}function r({types:e,template:t}){function n(t){return t=t.resolve(),e.isIdentifier(t)?t.node.name:t.evaluate().value}function r(e,t,n){if(!e)return n;const r=e.getOuterBindingIdentifierPaths();for(let o in r){const i=r[o].scope.bindings[o],s=i.referencePaths;i.constant||console.warn("Expected constant binding: "+o);for(let r=0;r<s.length;r++)if(s[r]!==e){const e=t(n,s[r],o);void 0!==e&&(n=e)}}return n}function o(t,o){const i={name:t,exports:{},defaultExport:void 0,exportIdentifiers:{},requires:[],references:0,referenceModules:new Set,factory:o,harmony:!1},[s,a,l]=o.get("params");function c(r){if(e.isCallExpression(r)){if(3!==r.get("arguments").length)return;const n=r.get("arguments.1"),o=r.get("arguments.2");if(!e.isFunction(o))return;const i=o.get("body.body.0.argument");return o.replaceWith(e.arrowFunctionExpression([],i.node)),p(i,t,n.evaluate().value)}if(!e.isMemberExpression(r))return void console.warn(`Not sure how to deal with ${r.node.type} on "module".\n${r.getSource()}`);const o=r.parentPath;if(!e.isAssignmentExpression(o))return void console.warn(`Expected exports[] assignment, but got ${o.node.type}.\n${o.getSource()}`);const s=n(r.get("property"));s?("__esModule"===s&&(i.harmony=!0),p(o,t,s)):console.warn("Dynamic exports are not supported.\n"+r.getSource())}function p(t,n,r){const o=t.scope.getProgramParent().generateDeclaredUidIdentifier("_"+n+"$"+r);t.replaceWith(e.assignmentExpression("=",e.clone(o),e.clone(t.node))),i.exports[r]=t,i.exportIdentifiers[r]=o,"default"===r&&(i.defaultExport=t)}return r(s,(r,o)=>{const i=o.parentPath,s=i.parentPath;if(e.isCallExpression(i)&&c(i),!e.isMemberExpression(i))return void console.warn(`Not sure how to deal with ${i.node.type} on "module".\n${i.getSource()}`);if(e.isMemberExpression(s))return c(s);if(!e.isAssignmentExpression(s))return void console.warn(`Expected module.exports assignment, but got ${s.node.type}.\n${s.getSource()}`);const a=n(i.get("property"));if("exports"!==a)return void console.warn(`Unexpected assignment to module[${a}].\n${i.getSource()}`);const l=s.get("right");if(e.isObjectExpression(l)&&l.evaluate().confident&&l.get("properties").every(t=>e.isObjectProperty(t))){const n=[];s.replaceWithMultiple(l.get("properties").map(t=>{let r=e.isIdentifier(t.node.key)?t.node.key.name:t.get("key").evaluate().value;const o=!e.isValidIdentifier(r),i=o?e.stringLiteral(r):e.identifier(r);return n.push(r),e.assignmentExpression("=",e.memberExpression(e.clone(s.node.left),i,o),e.clone(t.node.value))})).forEach((r,o)=>{e.isExpressionStatement(r)&&(r=r.get("expression")),p(r.get("right"),t,n[o])})}else p(l,t,"default")},[]),r(a,(e,t)=>{c(t.parentPath)},[]),o.scope.crawl(),r(l,(t,r)=>{const o=r.parentPath;if(e.isMemberExpression(o)){const e=n(o.get("property"));if(/^(r|d|register|define)$/.test(e))return;return void console.warn(`Unexpected require.${e} usage.\n${o.parentPath.getSource()}`)}const s=o.parentPath;if(!e.isCallExpression(o))return void console.warn(`Expected require() but found ${o.node.type}.\n${s.getSource()}`);const a=o.get("arguments.0");let l;if(e.isLiteral(a))l=a.node.value;else{const e=a.evaluate();if(!e.confident)return void console.warn("Unexpected dynamic require().\n"+s.getSource());l=e.value}i.requires.push({specifier:l,path:o})}),i}function i(n,r){for(const e of n.requires){const t=r.get(e.specifier);t&&(t.referenceModules.add(n),t.references++)}for(const o of n.requires){const n=r.get(o.specifier);if(!n){console.log("External module reference: ",o.specifier);continue}const i=o.path.parentPath;if(e.isVariableDeclarator(i)||e.isAssignmentExpression(i)){const t=e.isVariableDeclarator(i)?i.get("id"):i.get("left");if(e.isObjectPattern(t)){const t=i.getOuterBindingIdentifierPaths();let r=!1;for(const o in t){const i=t[o],s=i.scope.bindings[o],a=n.exportIdentifiers[i.parent.key.name];a?(i.parentPath.remove(),s.referencePaths.forEach(t=>{t.replaceWith(e.clone(a))})):r=!0}if(!r)return void o.path.getStatementParent().replaceWith(o.path.node)}}const s=n.exportIdentifiers.default;if(s){o.path.replaceWith(e.sequenceExpression([e.cloneDeep(o.path.node),e.identifier(s.name)]));const r=o.path.scope.getProgramParent(),i=r.bindings[s.name];i&&i.reference();const a=o.path.get("expressions.1"),c=l(a);if(c.confident&&(null===c.value||"object"!=typeof c.value)){if(a.replaceWith(t.ast(JSON.stringify(c.value))),n.references--,0===n.references){let t=n.factory;e.isMethod(t)||(t=t.parentPath),t.remove();for(let e in n.exportIdentifiers){const t=r.bindings[n.exportIdentifiers[e].name];t.dereference(),0===t.references&&t.path.remove()}}o.path.replaceWith(a.node)}}}}function s(t){const r=new Map;for(const o of t.requires){const t=o.path.parentPath;if(e.isVariableDeclarator(t)){const o=[],i=t.getOuterBindingIdentifierPaths();for(let t in i){const s=i[t].scope.bindings[t];if(s)for(const t of s.referencePaths)if(e.isMemberExpression(t.parent)){const i=n(t.parentPath.get("property"));let s=r.get(i);s||(s=i,e.isValidIdentifier(s)&&!t.scope.hasBinding(s)||(s=t.scope.generateUid(s)),o.push(e.objectProperty(e.identifier(i),e.identifier(s),!1,i===s)),r.set(i,s));let a=t.parentPath;e.isCallExpression(a.parent)&&"Object"===a.parent.callee.name&&(a=a.parentPath),a.replaceWith(e.identifier(s))}}t.get("id").replaceWith(e.objectPattern(o)),1===t.parent.declarations.length&&(t.parent.kind="const"),t.scope.crawl()}}}function a(n,r){for(const r in n.exports){const o=n.exports[r];let i=o.get("right").resolve();const s=o.get("left");let a,l;const c=i.scope.getProgramParent();let p=i;e.isAssignmentExpression(p)&&(p=p.get("right"));let d=p.isPure();if(p.evaluate().confident)d=!0;else if(e.isFunction(i)){const e=n.factory.get("body").scope.bindings;for(let t in e)if(e[t].referencePaths.some(e=>i.isAncestor(e))){d=!1;break}}if(d){let n=i.getOuterBindingIdentifierPaths();if(e.isFunctionDeclaration(i)||e.isClassDeclaration(i)){const n=l=i.node;let r;e.isClassDeclaration(i)?r=e.classExpression(n.id,n.superClass,n.body):(r=e.functionExpression(n.id,n.params,n.body),r.generator=n.generator,r.async=n.async);const o=a=i.replaceWith(t.ast`var ${n.id}=${r}`)[0];i=o.get("declarations.0.init")}const r=i.hoist(c);if(!r){l&&a.replaceWith(l);continue}let o=s.node;e.isIdentifier(o)||console.log(o),l&&(r.parentPath.scope.crawl(),r.parentPath.scope.checkBlockScopedCollisions(r.parentPath.scope.bindings[r.parent.id.name])||r.parentPath.scope.rename(r.parent.id.name,l.id.name));const p=r.parent.id;for(let t in n){const n=i.scope.getBinding(t);n.referencePaths.forEach(t=>{n.dereference(),t.replaceWith(e.clone(p))}),n.references||n.path.remove()}r.parentPath.scope.crawl(),r.parentPath.scope.bindings[p.name].referencePaths.forEach(t=>{e.isAssignmentExpression(t.parent)&&e.isNodesEquivalent(t.getOpposite(),s)?t.parentPath.replaceWith(e.clone(o)):t.replaceWith(e.clone(o))}),r.parentPath.get("id").replaceWith(e.clone(o)),r.parentPath.scope.getBinding(o.name).path.remove()}}}function l(t){let n=t.evaluate();if(n.deopt){const t=function t(n){if(!n.resolve().node){if(e.isVariableDeclarator(n)){const e=n.getOuterBindingIdentifierPaths(),r=n.scope.bindings[Object.keys(e)[0]];if(r.constantViolations&&1===r.constantViolations.length)return t(r.constantViolations[0])}if(e.isAssignmentExpression(n)&&"="===n.node.operator)return t(n.get("right"))}return n}(n.deopt);if(t&&t!==n.deopt)return l(t);if(e.isAssignmentExpression(t)&&"="===t.node.operator)return l(t.get("right"))}return n}return{name:"transform-optimize-webpack",visitor:{Program(t,r){const l=t.get("body").filter(e.isStatement);if(1!==l.length)return;const c=function t(n){return e.isExpressionStatement(n)?t(n.get("expression")):e.isUnaryExpression(n)&&"!"===n.node.operator?t(n.get("argument")):n}(l[0]);if(!e.isCallExpression(c))return;const p=c.get("callee"),d=t.hub.file.filename||t.hub.file.metadata.filename||"<file>";let f=!1;if(e.isFunction(p)){if(function(t){const n={};t.get("body").traverse({MemberExpression(r){if(r.scope===t.scope&&e.isAssignmentExpression(r.parent)&&e.isIdentifier(r.node.object)&&e.isIdentifier(r.node.property)){let e=n[r.node.object.name];e||(e=n[r.node.object.name]={}),e[r.node.property.name]=r}}});for(const e in n){const t=n[e];if(t.p&&t.c&&t.oe)return!0}return!(!n.window||!n.window.webpackJsonp)}(p))return console.log("not a webpack bootstrap");f=!0}else{if(!e.isMemberExpression(p))return;if("push"!==n(p.get("property")))return;if(!function t(r){if(e.isAssignmentExpression(r))return t(r.get("left"));if(!e.isMemberExpression(r))return!1;const o=r.get("object").resolve();return!!/^(window|top|self|globalThis)$/.test(n(o))&&"webpackJsonp"===n(r.get("property"))}(p.get("object")))return void console.info(d+" is not a webpack bundle.")}console.info(`${d} is a Webpack bundle (non-entry, ${f?"with runtime":"no runtime"}).`),c.get("arguments").forEach(t=>{let l=t.get("elements.1")||t;const c=new Map;r.set("modules",c);let p=0;if(e.isCallExpression(l)){const t=l.get("callee");if(e.isMemberExpression(t)&&e.isCallExpression(t.get("object"))&&"Array"===n(t.get("object.callee"))&&"concat"===n(t.get("property"))){const n=t.get("object.arguments");if(1!==n.length||!e.isNumericLiteral(n[0]))return void console.error("Unknown webpackJsonp chunk format: "+t.getSource());p=n[0].node.value,l=l.get("arguments.0")}else console.warn("Unknown webpackJsonp expression: "+t.getSource())}e.isObjectExpression(l)?l.get("properties").forEach(t=>{const r=n(t.get("key")),i=o(r,e.isObjectMethod(t)?t:t.get("value"));c.set(r,i)}):e.isArrayExpression(l)&&l.get("elements").forEach((e,t)=>{const n=p+t;if(!e.node)return void console.warn(`Missing information for module ID ${n} (offset ${p}). Possibly corrupted bundle.`);const r=o(n,e);c.set(n,r)});for(let e of c.values())s(e),i(e,c),a(e);let d={};c.forEach((e,t)=>{d[t]=e}),console.log("modules: ",d)})}}}}function o({types:e}){const t=e=>e.replace(/(`|${)/g,"\\$1"),n=t=>e.isMemberExpression(t)&&e.isIdentifier(t.node.property,{name:"concat"}),r=t=>e.isCallExpression(t)&&n(t.get("callee"));return{name:"transform-template-literals",visitor:{BinaryExpression(n){if("+"!==n.node.operator)return;if(e.isBinaryExpression(n.parent))return;let r=n;const o=[];for(;r&&r.isBinaryExpression();)o.push(r.get("right")),r=r.get("left");if(r&&o.push(r),o.reverse(),o.length<2)return;const i=[],s=[];let a="",l=!0,c=!1;for(let n=0;n<o.length;n++){const r=n===o.length-1,p=o[n];if(p.isStringLiteral())a+=p.node.value,l=!0;else{if(!l)return;i.push(e.templateElement({raw:t(a)},r)),s.push(e.clone(p.node)),c=!0,l=!1,a=""}}c&&(i.push(e.templateElement({raw:t(a)},!0)),n.replaceWith(e.templateLiteral(i,s)))},CallExpression(o){const i=o.get("callee");if(!n(i))return;const s=i.get("object");if(!e.isStringLiteral(s))return;const a=[e.templateElement({raw:t(s.node.value)})],l=[],c=[o.get("arguments")];let p=o,d=o;for(;d=d.parentPath&&d.parentPath.parentPath;)if(r(d)){const t=d.get("callee.object");if(t!==p&&!e.isStringLiteral(t))break;c.push(d.get("arguments")),p=d}if(1!==c.length||0!==c[0].length){for(let n=0;n<c.length;n++){const r=c[n],o=n===c.length-1;for(let n=0;n<r.length;n++){const i=r[n].node;if(n%2){if(!e.isStringLiteral(i))return;const s=o&&n===r.length-1;a.push(e.templateElement({raw:t(i.value)},s))}else e.isExpression(i)&&l.push(e.clone(i))}a.length<=l.length&&a.push(e.templateElement({raw:""},o))}p.replaceWith(e.templateLiteral(a,l))}}}}}t.push("window","self","Math");var i=({types:e})=>({name:"transform-array-spread",visitor:{CallExpression(t){const n=t.get("callee");if(e.isMemberExpression(n)&&e.isIdentifier(n.node.property,e.identifier("concat"))){const r=n.get("object"),o=t.get("arguments");if(e.isArrayExpression(r)){const n=[];if(!o.every(r=>{if(e.isArrayExpression(r))return n.push(...r.node.elements),!0;if(r.isLiteral()||e.isObjectExpression(r))return n.push(r.node),!0;if(e.isObjectExpression(r))return n.push(r.node),!0;if(!e.isIdentifier(r))return;const o=t.scope.getBinding(r.node.name);return o&&o.constant&&"param"===o.kind&&e.isRestElement(o.path)?(n.push(e.spreadElement(r.node)),!0):void 0}))return;const i=e.isArrayExpression(r)?e.clone(r.node):e.arrayExpression([r.node]);i.elements.push(...n),t.replaceWith(i),t.skip()}}}}}),s=({types:e})=>({name:"transform-implicit-scope",visitor:{Program(t){const n=t.get("body");if(1===n.length){let r=n[0];if(e.isExpressionStatement(r)&&(r=r.get("expression")),e.isUnaryExpression(r)&&(r=r.get("argument")),e.isCallExpression(r)){const o=r.get("callee");if(!e.isFunction(o))return;if(o.node.async||o.node.generator)return;for(let e of o.get("params")){const t=e.getBindingIdentifiers();for(let n in t)if(e.scope.getBinding(n).referenced)return}o.get("body.body").forEach(t=>{e.isReturnStatement(t)&&t.replaceWith(t.get("argument"))}),n[0].replaceWithMultiple(o.node.body.body||o.node.body),t.scope.crawl()}}}}}),a=({types:e})=>({name:"transform-iife-arrows",visitor:{"FunctionExpression|FunctionDeclaration"(t){let n=t.parentPath;if(e.isExpressionStatement(n)&&(n=n.parentPath),!e.isCallExpression(n)){const e=t.getOuterBindingIdentifierPaths();for(let r in e){const e=t.scope.getBinding(r);if(!e.constant||1!==e.references)return;n=e.referencePaths[0].parentPath}}if(!e.isCallExpression(n))return;let r=!1;if(t.traverse({BlockStatement(n){e.isFunction(n.parent)&&n.parentPath!==t&&n.stop()},ThisExpression(e){r=!0,e.stop()},Identifier(e){"arguments"===e.node.name&&(r=!0,e.stop())}}),r)return;const o=e.clone(t.node);o.type="ArrowFunctionExpression",1===o.body.body.length&&e.isReturnStatement(o.body.body[0])&&(o.body=o.body.body[0].argument),e.isFunctionDeclaration(t)?t.replaceWith(e.variableDeclaration("var",[e.variableDeclarator(e.clone(t.node.id),o)])):t.replaceWith(o)}}});function l({types:e}){const t=(e,t)=>e.isCallExpression()&&n(e.get("callee"),t),n=(e,t)=>e.isMemberExpression()&&(r(e.get("property"),t)||e.get("property").evaluate().value===t),r=(e,t)=>e.isIdentifier()&&e.node.name===t;function o(e,t,n){if(!e.isBinaryExpression()||"+"!==e.node.operator)return!1;const r=e.get("left");return!(!r.isStringLiteral()||r.node.value!==t||n&&!i(e.get("right"),n))}const i=(t,n)=>e.isNodesEquivalent(t.node||t,n.node||n),s=[["addEventListener","attachEvent",!0],["removeEventListener","detachEvent",!0],["attachEvent","addEventListener",!1],["detachEvent","removeEventListener",!1]];return{name:"transform-fallbacks",visitor:{ConditionalExpression(e){const r=function(e,r,a){for(const[l,c,p]of s){if(!n(e,l))continue;if(!t(r,l)||!t(a,c))continue;let[s,d]=p?[a,r]:[r,a];if(o(s.get("arguments.0"),"on",d.get("arguments.0"))&&i(s.get("arguments.1"),d.get("arguments.1")))return d}}(e.get("test"),e.get("consequent"),e.get("alternate"));r&&e.replaceWith(r.node)}}}}var c=({types:e})=>({name:"transform-methods",visitor:{ObjectProperty(t){const n=t.get("value");let r=n;if(!e.isFunction(r)||e.isArrowFunctionExpression(r))return;if(r!==n){const e=r.getOuterBindingIdentifierPaths();for(let t in e){const e=r.scope.getBinding(t);if(!e.referencePaths.concat(e.constantViolations).every(t=>t.isDescendant(r)||t.equals(n)||t.equals(e.path)))return}}const{node:o}=r,i=e.objectMethod("method",e.clone(t.node.key),o.params,o.body);i.async=o.async,i.generator=o.generator,t.replaceWith(i),r!==n&&r.remove()}}}),p=({types:e})=>{function t(e,t){let n=!1;const r="function"==typeof t?t:e=>e&&e.match(t);return e.traverse({Function(e){e.skip()},StringLiteral(e){r(e.node.value)&&(n=!0,e.stop())},TemplateLiteral(e){const t=e.node.quasis.map(e=>e.value).join("${}");r(t)&&(n=!0,e.stop())}}),n}function n(e){if(!e.node)return;let t=!1;return e.traverse({CallExpression(e){i(e.node.callee,"Reflect","construct")&&(t=!0,e.stop())},Function(t){const n=t.getBindingIdentifiers(),r=t.scope.getBinding(Object.keys(n)[0]);r&&e.isAncestor(r.path)||t.skip()}}),t}function r(t){const n=t.get("body.body").find(e.isReturnStatement);return n&&n.get("argument").resolve()}function o(t,n){return e.isIdentifier(t,{name:n})}function i(t,n,r){const i="node"in t?t.node:t;return e.isMemberExpression(i)&&o(i.object,n)&&o(i.property,r)}function s(t,r){const i=t.node.callee;if(!e.isMemberExpression(i))return!1;let s,a,l=t.get("callee.object").resolve();if(e.isMemberExpression(l)&&o(l.node.property,"call")&&(s="call",l=l.get("object").resolve()),e.isCallExpression(l)&&n(l.get("callee").resolve()))a=l.get("callee").resolve();else if(!l||l.node!==r.node)return!1;const c=i.property;let p,d=!1;if(o(c,"apply"))d=!0,p=[t.get("arguments.1")],"call"===s&&(p[0].isCallExpression()&&e.isMemberExpression(p[0].node.callee)&&o(p[0].node.callee.property,"concat")?p=p[0].get("arguments"):console.warn("Unhandled Super.call.apply() usage: "+t.getSource()));else{if(!o(c,"call"))return!1;p=t.get("arguments.0").getAllNextSiblings()}return{apply:d,args:p,helper:a}}function a(t,a){const l=t.parentPath.getFunctionParent();if(!l)return;const c=r(l);if(!c)return;if(!e.isNodesEquivalent(c.node,t.node))return;const p=l.parentPath;if(!p.isCallExpression())return;let d,f=[];const g=l.get("params.0");l.get("body.body").forEach(r=>{if(r.isExpressionStatement()&&(r=r.get("expression")),r.isAssignmentExpression()){const n=r.get("left");if(n.isMemberExpression()){const i=function(e){let t=e.resolve();if(t.isIdentifier()){const e=t.scope.getBinding(t.node.name).path.parentPath.get("init");if(e&&e.node)return e.resolve()}return t}(n.get("object")),s=i.node===t.node,a=i.isMemberExpression()&&o(i.node.property,"prototype")&&i.get("object").resolve().node===t.node;if(s||a){const t=e.clone(n.node.property),o=r.node.right;if(e.isFunction(o)){const r=e.classMethod("method",t,o.params,o.body,n.node.computed,s);r.async=o.async,r.generator=o.generator,f.push(r)}else{const r=e.classProperty(t,o,null,null,n.node.computed,s);f.push(r)}}}}if(r.isVariableDeclaration()){const e=r.get("declarations.0.init.callee").resolve();if(e.node&&n(e))return void(d=r.get("declarations.0.id"))}if(!r.isCallExpression())return;const i=r.get("arguments");if(i.length<2)return;if(!e.isNodesEquivalent(i[0].node,t.node.id))return;if(g&&2===i.length&&e.isNodesEquivalent(i[1].node,g.node)){const t=r.get("callee").resolve();return void(e.isFunction(t)&&(a.helpers.add(t),r.remove()))}if(2!==i.length)return;const s=i[1];if(!s.isArrayExpression())return;if(!s.get("elements").every(t=>{if(!t.isObjectExpression())return!1;let n={};for(const e of t.node.properties){if(e.method||e.computed)return!1;n[e.key.name]=e.value}if(!e.isStringLiteral(n.key))return!1;const r=(t,r)=>{const o=e.classMethod(t,e.identifier(n.key.value),r.params,r.body,!1,!1);o.async=n.value.async,o.generator=n.value.generator,f.push(o)};return n.value&&r("method",n.value),n.get&&r("get",n.get),n.set&&r("set",n.set),!0}))return;const l=r.get("callee").resolve();if(l&&/\.enumerable[\s\S]+\.prototype/.test(l.getSource())){a.helpers.add(l);const e=r.scope.getBinding(r.node.callee.name);e.dereference(),a.helpers.add(e.path)}else if(l){const e=r.scope.getBinding(r.node.callee.name);e.dereference(),a.helpers.add(e.path)}});let u=p.get("arguments.0");if(u.isCallExpression()){const t=u.get("callee").resolve();if(t&&t.isFunction()){const n=r(t);if(n.scope.getBinding(n.node.id.name).referencePaths.some(t=>e.isCallExpression(t.parent)&&i(t.parent.callee,"Object","setPrototypeOf"))&&n&&n.isFunction()){const e=r(n);e&&e.isCallExpression()&&i(e.node.callee,"Reflect","construct")&&(u=u.get("arguments.0"),a.helpers.add(t))}}}t.get("body.body").every(n=>{n.isExpressionStatement()&&(n=n.get("expression"));let r=n;if(e.isReturnStatement(r)&&(r=r.get("argument")),e.isLogicalExpression(r)&&"||"===r.node.operator&&e.isThisExpression(r.node.right)&&(r=r.get("left")),!e.isCallExpression(r))return!0;const i=s(r,g);if(i.helper&&a.helpers.add(i.helper),!i)return!0;i.apply&&1===i.args.length&&o(i.args[0].node,"arguments")&&(i.args=[]);let l,c,p=[],d=[];if(e.isVariableDeclarator(r.parent)&&"init"===r.parentKey){const n=r.parentPath.get("id");for(const r of n.scope.getBinding(n.node.name).referencePaths)r.getFunctionParent().node!==t.node?l=n.node.name:e.isReturnStatement(r.parent)?r.parentPath.remove():r.replaceWith(e.thisExpression());r=r.parentPath,e.isVariableDeclaration(r.parent)&&(c=r.parent.kind,r.getAllPrevSiblings().length&&p.push(e.variableDeclaration(c,p)),r.getAllNextSiblings().length&&d.push(e.variableDeclaration(c,d)),r=r.parentPath)}l&&d.unshift(e.variableDeclaration(c||"var",[e.variableDeclarator(e.identifier(l),e.thisExpression())]));let f=i.args.map(e=>e.node);if(i.apply){let t=f.pop();t&&f.push(e.spreadElement(t))}n.replaceWithMultiple([...p,e.expressionStatement(e.callExpression(e.identifier("super"),f)),...d])});const m=e.clone(t.node.id),h=u&&u.node,b=[];for(let e=t.node.params.length;e--;)b[e]=t.node.params[e]||t.scope.generateUidIdentifier();const v=function(t){if(e.isBlockStatement(t)){if(1!==t.node.body.length)return;t=t.get("body.0")}return e.isExpressionStatement(t)&&(t=t.get("expression")),t}(t.get("body"));let y=!1;if(e.isCallExpression(v)&&o(v.node.callee,"super")){const t=v.get("arguments");(0===t.length||1===t.length&&e.isSpreadElement(t[0])&&e.isRestElement(b[0])&&e.isNodesEquivalent(t[0].node.argument,b[0].argument))&&(y=!0)}y||f.unshift(e.classMethod("constructor",e.identifier("constructor"),b,t.node.body));const x=e.classBody(f);e.isVariableDeclarator(p.parent)&&e.isNodesEquivalent(p.parent.id,m)&&1===p.parentPath.parent.declarations.length?p.parentPath.parentPath.replaceWith(e.classDeclaration(m,h,x)):p.replaceWith(e.classExpression(m,h,x))}return{name:"transform-infer-classes",visitor:{Identifier(t){if(o(t.node,"arguments")&&e.isMemberExpression(t.parent)){const n=t.getFunctionParent(),r=t.parentPath;let s,a=r.parentPath;const l=r.get("property").evaluate().value;if("length"===l)return;if(!e.isVariableDeclarator(a)){const t=function(t,n){const r=t.parentPath;let s;if(r.isConditionalExpression()){if("consequent"===t.parentKey)s=r.get("alternate");else{if("alternate"!==t.parentKey)return;s=r.get("consequent")}if(function(t){let n=!1;return t.visit({Identifier(r){(n=e.isIdentifier(r,{name:"arguments"}))&&t.stop()}}),n}(s))return console.warn("Bailout: fallback references arguments[]"),!1;const a=t.findParent(e=>e.isVariableDeclarator()),l=e=>{let t;switch(e.node.type){case"LogicalExpression":if("&&"===e.node.operator)return l(e.get("left"))&&l(e.get("right"));if("||"===e.node.operator)return l(e.get("left"))||l(e.get("right"));throw console.warn("Unknown operator "+e.node.operator),5;case"BinaryExpression":if(i(e.node.left,"arguments","length")){const t=e.get("right").evaluate().value;return">"==e.node.operator?t>=n:t<n}if(i(e.node.right,"arguments","length")){const t=e.get("left").evaluate().value;return">"==e.node.operator?t<n:t>=n}if(o(e.node.left,"undefined")?t=e.get("right"):o(e.node.right,"undefined")&&(t=e.get("left")),!t)throw console.log(e.getSource()),2;if("!"===e.node.operator[0])return l(t);if("="===e.node.operator[0])return!l(t);throw 4;case"MemberExpression":{if(!o(e.node.object,"arguments"))throw 6;const t=e.get("property").evaluate().value;if("length"===t)return!0;if(t===n)return!0;throw 7}case"Identifier":if("arguments"===e.node.name)return!0;throw 3;case"NumericLiteral":return e.node.value===n;default:throw-1}};let c,p=r.get("test");try{c=l(p)}catch(e){console.log(`bailout ${r.parentPath.get("id").getSource()} ${n}: ${e}`)}if("boolean"==typeof c)return{decl:a,fallback:s&&s.node}}}(r,l);if(!t)return!1;({decl:a,fallback:s}=t)}if(e.isVariableDeclarator(a)){const t=e.clone(a.node.id),r=n.get("params");let o=t;s&&(o=e.assignmentPattern(o,s)),l===r.length?n.pushContainer("params",o):n.node.params[l]=o,a.remove()}return}if(!o(t.node,"exports")||t.scope.getBinding("exports"))return;let n=t.parentPath;if(n&&n.isCallExpression()&&"arguments"===t.parentKey){if(i(n.node.callee,"Object","defineProperty")){const t=n.get("arguments.1");if(!e.isStringLiteral(t))throw Error("Unknown defineProperty call: "+n.getSource);const i=n.get("arguments.2.properties").find(e=>o(e.node.key,"get"));if(!i)return;const s=r(i.get("value"));e.isExpressionStatement(n.parent)&&(n=n.parentPath),console.log("TODO: implement definePropery() reconstruction",s)}}else if(n.isMemberExpression()&&"object"===t.parentKey&&e.isIdentifier(n.node.property)){const e=n.parentPath;let t=e;for(;t.node&&t.isAssignmentExpression();)if(t=t.get("right"),o(t.node,"undefined")){let n=t.parentPath;return void(n&&n.isExpressionStatement()?n.remove():n&&n.isAssignmentExpression()?e.replaceWith(t.node.right):e.remove())}}},Program:{enter(e,t){t.helpers=new Set},exit(e,t){let n=e.scope.bindings;function r(e){const t=e.path.node;return e.referencePaths.filter(e=>e&&e.node!==t&&!e.findParent(e=>e.node===t||e.removed))}t.helpers.forEach(function t(o){if(o.removed)return;const i=o.getOuterBindingIdentifierPaths();for(let e in i)o.scope.removeBinding(e);try{o.remove()}catch(e){}for(const i in n){const n=e.scope.getBinding(i);if(!n)continue;const s=r(n);let a=s.length;for(const e of s)e.isDescendant(o)&&(n.dereference(),a--);a||t(n.path)}})}},CallExpression(n,o){const i=n.get("callee").resolve();if(function(e){return e.node&&t(e,/super\(\) hasn't been called/)}(i)){o.helpers.add(i);let t=n.parentPath;if(e.isVariableDeclarator(t)){const r=t.get("id").getOuterBindingIdentifierPaths(),o=r[Object.keys(r)[0]];o.scope.getBinding(o.node.name).referencePaths.forEach(e=>{const t=e.parentPath;t&&t.isReturnStatement()&&t.remove()}),o.scope.rename(o.node.name,"this"),t=t.parentPath,n.node.arguments[1]||(console.log(n.node.arguments[0]),console.log(n.getSource())),t.replaceWith(e.callExpression(e.identifier("super"),n.node.arguments[1].arguments.slice(1).map(e.clone)))}return}if(function(e){return e.node&&t(e,/call a class as a function/)}(i)){o.helpers.add(i);const e=n.getFunctionParent();return n.remove(),void a(e,o)}let l=n.getFunctionParent();if(!l)return;let c=l.parentPath;if(e.isBlockStatement(c)&&(c=c.parentPath),!e.isFunctionExpression(c))return;const p=r(c);p&&e.isNodesEquivalent(l.node,p.node)&&e.isCallExpression(c.parent)&&s(n,c.get("params.0"))&&a(l,o)},BinaryExpression(t){if("instanceof"===t.node.operator){let n=!0,r=t.parentPath;if(r&&r.isUnaryExpression()&&"!"===r.node.operator&&(n=!1,r=r.parentPath),!o(t.node.left,"this"))return;const i=t.getFunctionParent();if(!i)return;if(!e.nodesIsEquivalent(t.node.right,i.node.id))return;n?r.replaceWith(r.node.block):r.remove()}}}}},d=({types:e})=>{function t(t){if(t=t.resolve(),!e.isIdentifier(t)){const n=t.parentPath;if(e.isVariableDeclarator(n))return n.get("id");if(e.isAssignmentExpression(n))return n.get("left")}return t}function n(t){if(t=t.resolve(),e.isSequenceExpression(t)){let e;for(e of t.get("expressions")){const t=e.evaluate();if(!t.confident||t.value)break}return n(e)}return e.isLogicalExpression(t)&&"&&"===t.node.operator&&e.isThisExpression(t.node.left)?n(t.get("right")):e.isLogicalExpression(t)&&"||"===t.node.operator?n(t.get("left")):e.isMemberExpression(t)&&e.isIdentifier(t.node.property,{name:"default"})?n(t.get("object")):e.isCallExpression(t)&&r(t.get("callee"),"@babel/runtime/helpers/interopRequireDefault")?n(t.get("arguments.0")):t}function r(t,n){let r;return t=t.resolve(),e.isCallExpression(t)&&e.isIdentifier(t.node.callee,{name:"require"})?r=t.get("arguments.0").node.value:e.isImportSpecifier(t.parent)&&(r=t.parentPath.parentPath.get("source").node.value),!!r&&("string"==typeof n?r===n:n.test(r))}function o(t){if(r(t,{test:()=>!0})){const n=t.getStatementParent().getBindingIdentifierPaths();for(let i in n){const n=t.scope.getBinding(i);if(n.dereference(),!n.referenced){const i=t.parentPath;e.isCallExpression(i)&&r(i.get("callee"),"@babel/runtime/helpers/interopRequireDefault")&&o(i.get("callee").resolve()),n.path.remove()}}}}function i(t){if(t=t.resolve(),e.isMemberExpression(t)){const n=t.get("object").resolve(),r=t.get("property").resolve();return e.isIdentifier(n.node,{name:"Object"})&&e.isIdentifier(r.node,{name:"assign"})}return!1}function s(r){if(!e.isIdentifier(r))return;const a=r.scope.getBinding(r.node.name);if(!a)return void console.warn("No binding for "+r.node.name);const l=a.referencePaths;if(!a.constant||!l.length||a.constantViolations.length)return;let c,p,d=!1,f=!1,g=[];if(!l.every(s=>{const a=s.parentPath,l=a.parentPath;if(function(r,o){if(!e.isMemberExpression(r)&&(r=n(r),!e.isMemberExpression(r)))return!1;let i=r.get("object");return!(!e.isNodesEquivalent(i.node,o.node)&&(i=t(i),!e.isNodesEquivalent(i.node,o.node))||!e.isIdentifier(r.node.property,{name:"slice"}))}(a,r)&&l.node.arguments.length<2)return f=!0,c=l.parentPath,d=!0,p=l.get("arguments.0").node.value,!0;if(e.isMemberExpression(a)){if("object"===s.key&&e.isVariableDeclarator(l))return g.push(l),!0}else if(function(r,s){if(!r.isCallExpression())return!1;const a=r.get("arguments");let l=n(r.get("callee"));if(2!==a.length)return!1;if(i(l))return!(!e.isObjectExpression(a[0])||a[0].get("properties").length||!e.isIdentifier(t(a[1]).node,s.node)||(o(l),0));if(!e.isArrayExpression(a[1]))return!1;for(let t of a[1].get("elements"))if(!e.isStringLiteral(t))return!1;return!(!e.isObjectExpression(a[0])||a[0].get("properties").length)||!!e.isIdentifier(t(a[0]).node,s.node)&&(o(l),!e.isMemberExpression(l)||(function(t){if(e.isIdentifier(t)){const e=t.getOuterBindingIdentifierPaths();for(let n in e){const e=t.scope.getBinding(n);e.dereference(),e.referenced||e.path.remove()}}}(r.get("callee")),e.isThisExpression(l.node.object)&&e.isIdentifier(l.node.property,{name:"__rest"})))}(a,r))return c=a,!0;return!1}))return;if(f&&!g.length)return;const u=[],m=[];for(let t of g){let n=t.node.init.property,r=t.node.init.computed,o=e.isIdentifier(n)?n.name:null;if(r){const i=t.get("init.property").resolve().node;if(e.isLiteral(i))o=String(i.value),r=!1,n=/^[a-z0-9$_]*$/gi.test(o)?e.identifier(o):e.stringLiteral(o);else{const i=t.get("init.property").evaluate();if(!i.confident)return;o=String(i.value),r=!1,n=/^[a-z0-9$_]*$/gi.test(o)?e.identifier(o):e.stringLiteral(o)}}d?u[o]=e.clone(t.node.id):(m.push(o),u.push(e.objectProperty(e.clone(n),e.clone(t.node.id),r,!0))),t.remove()}if(c){if(e.isAssignmentExpression(c))return;let t;if(d)t=c.node.id,u[p||u.length]=e.restElement(e.clone(t));else if(e.isCallExpression(c)&&i(c.get("callee")))t=c.node.arguments[1],u.push(e.restElement(e.clone(t)));else{const n=c.get("init.arguments.1.elements");Array.isArray(n)&&n.length&&n.forEach(t=>{const n=t.node.value;m.includes(n)||u.push(e.objectProperty(e.identifier(n),e.identifier(n),!1,!0))}),t=c.node.id,u.push(e.restElement(e.clone(t)))}e.isVariableDeclaration(c.parent)||e.isExpressionStatement(c.parent)?c.remove():c.replaceWith(e.clone(t))}if(d){for(let e=u.length;e--;)u[e]||(u[e]=null);const t=e.arrayPattern([]);t.elements=u,r.replaceWith(t)}else r.replaceWith(e.objectPattern(u));r.scope.crawl();const h=r.getBindingIdentifierPaths();for(let t in h)e.isIdentifier(h[t])&&s(h[t])}return{name:"transform-destructuring",visitor:{Program:{enter(e,t){t.set("assignUsage",new Set)},exit(t,n){const o=n.get("assignUsage"),i=/core-js\/modules\/es\.object\.assign|(^(object-assign|object.assign)$)/;Array.from(o).filter(e=>!e.removed).length||t.get("body").forEach(t=>{e.isExpressionStatement(t)&&(t=t.get("expression")),e.isCallExpression(t)&&r(t,i)&&t.remove()})}},MemberExpression(e,t){i(e)&&t.get("assignUsage").add(e)},Function(e){e.get("params").forEach(s)},VariableDeclarator(e,t){t.opts.parametersOnly||s(e.get("id"))}}}};function f({types:e}){const t=e.identifier("undefined"),n=e.identifier("arguments"),r=e=>"node"in e?e.node:e;function o(n){const o=r(n);return!(!e.isIdentifier(o)||!e.isIdentifier(o,t))||!(!e.isUnaryExpression(o)||"void"!==o.operator)}function i(e,t){return"node"in e?e.get(t):e[t]}function s(t,n="==="){const s=r(t);return n=n.slice(0,2),e.isBinaryExpression(s)&&s.operator.slice(0,2)===n&&(o(s.left)?i(t,"right"):o(s.right)?i(t,"left"):null)||!1}function a(t){if(e.isBlockStatement(t)){if(1!==t.node.body.length)return;return t.get("body.0")}if(e.isExpressionStatement(t))return t}function l(t,n,o){if(!t.getFunctionParent())return;const i=s(n,"==");if(i&&e.isAssignmentExpression(o)&&e.isNodesEquivalent(i.node,o.node.left)){const e=t.scope.getBinding(r(i).name);e&&"param"===e.kind&&(e.path.replaceWith(c(e.identifier,o.node.right)),t.remove())}}function c(t,n){const i=e.clone(r(t));return o(n)?i:e.assignmentPattern(i,e.clone(r(n)))}return{name:"transform-arguments",visitor:{AssignmentExpression(t,n){if(n.opts.loose&&t.getFunctionParent()&&"="===t.node.operator&&e.isLogicalExpression(t.node.right)&&"||"===t.node.right.operator&&e.isIdentifier(t.node.left)&&e.isIdentifier(t.node.right.left)&&t.node.right.left.name===t.node.left.name){const n=t.get("right"),r=n.node.left,o=n.scope.getBinding(r.name);if("param"===o.kind)return o.path.replaceWith(c(r,n.node.right)),void(e.isExpressionStatement(t.parent)?t.remove():t.replaceWith(r))}},VariableDeclarator(t,o){let i=t.get("init");if(!i.node)return;let a=i.get("test"),l=i.node&&i.node.alternate;if(e.isLogicalExpression(i))a=i.get("left"),l="&&"===i.node.operator?e.booleanLiteral(!1):i.get("alternate");else if(!e.isConditionalExpression(i))return;const p=t.getFunctionParent();if(!p)return;let d=a;if(e.isLogicalExpression(a)&&(d=s(a.get("left"),"!=")||s(a.get("right"),"!=")),!function(t,n){const o=s(n,"==");if(!o)return;const i=r(o).name,a=o.scope.getBinding(i);if(!a||"param"!==a.kind)return;let l=a.path;return e.isObjectPattern(l)&&(l=l.getBindingIdentifierPaths()[i]),l.replaceWith(c(t.node.id,t.node.init.consequent)),t.remove(),!0}(t,a)){if(e.isMemberExpression(d)&&e.isIdentifier(d.node.object,n)&&e.isNumericLiteral(d.node.property)){const e=d.node.property.value,n=t.get("id").node;p.node.params[e]=c(n,l),t.remove()}else if(e.isBinaryExpression(d)&&e.isMemberExpression(d.get("left"))&&e.isIdentifier(d.node.left.object,n)&&e.isIdentifier(d.node.left.property,{name:"length"})&&e.isNumericLiteral(d.node.right)&&">"===d.node.operator[0]){let e=d.node.right.value;">="===d.node.operator&&(e+=1);const n=t.get("id").node;p.node.params[e]=c(n,l),t.remove()}for(let e=0;e<p.node.params.length;e++)p.node.params[e]=p.node.params[e]||t.scope.generateUidIdentifier("_un")}},LogicalExpression(e){l(e,e.get("left"),e.get("right"))},IfStatement(e){const t=a(e.get("consequent"));t&&l(e,e.get("test"),t.get("expression"))},ForStatement(t){const r=t.getFunctionParent();if(!r)return;const o=a(t.get("body"));if(!o)return;const i=o.get("expression");if(!e.isAssignmentExpression(i)||"="!==i.node.operator)return;const s=i.get("left"),l=i.get("right");if(!e.isMemberExpression(s)||!e.isMemberExpression(l)||!e.isIdentifier(l.node.object,n))return;const c=l.get("property").scope.getBinding(l.get("property").resolve());if(!c)return;const p=c.path.get("init").evaluate();if(!p.confident)return;const d=s.get("object").node;let f=s.get("property"),g=p;if(e.isBinaryExpression(f)&&(g=f.get("right").evaluate(),f=f.get("left")),e.isNodesEquivalent(f.node,c.path.get("id").node)&&g&&g.confident&&g.value===p.value){if("var"===t.get("init").node.kind){if(c.path.remove(),s.get("object").resolve().parentPath.remove(),t.node.init)for(const r of t.get("init.declarations")){const t=r.node.init;e.isMemberExpression(t)&&e.isIdentifier(t.object,n)&&e.isIdentifier(t.property,e.identifier("length"))&&r.remove()}t.get("init").node&&t.get("init.declarations").length&&t.insertBefore(e.clone(t.get("init").node))}t.remove(),r.node.params[g.value]=e.restElement(e.clone(d));for(let e=g.value;e--;)r.node.params[e]||(r.node.params[e]=r.scope.generateUidIdentifier());r.scope.crawl()}}}}}var g=({types:e,parse:t})=>{function n(t,n){const r=t.get("body").filter(t=>e.isImportDeclaration(t.node)),o=r[r.length-1];o?o.insertAfter(n):t.unshiftContainer("body",n)}function r(t){const n=t.resolve();return!!o(n)||!n.scope.getBinding("exports")&&(!e.isMemberExpression(n.parentPath)||"property"!=t.key)&&e.isIdentifier(n)&&"exports"===n.node.name}function o(t){if(!e.isMemberExpression(t))return!1;if(t.scope.getBinding("module"))return!1;const n=t.get("property").resolve();return e.isIdentifier(n)&&"exports"===n.node.name}function i(t){const n=t.parentPath;if("object"==t.key&&e.isMemberExpression(n)){if(n.node.computed){const r=n.get("property").evaluate();if(r&&r.confident&&e.isValidIdentifier(r.value)){const o=e.isIdentifier(n.get("property")),i=n.get("property").node.name;if(n.get("property").replaceWith(e.identifier(r.value+"")),o){t.scope.crawl();const e=t.scope.getBinding(i);e.referenced||e.path.remove()}return!0}return!1}return!0}return!(!e.isVariableDeclarator(n)||!e.isObjectPattern(n.node.id)||n.get("id.properties").some(e.isRestElement))}return{name:"transform-cjs-to-esm",visitor:{MemberExpression(e,t){t.get("error")||o(e)&&t.get("toReplace").push(e)},Identifier(e,t){t.get("error")||r(e)&&t.get("toReplace").push(e)},Program:{enter(e,t){t.set("imports",[]),t.set("exports",[]),t.set("locals",new Map),t.set("toReplace",[]),t.set("replaced",new Set)},exit(r,i){if(i.get("error")){const e=t(r.hub.getCode()).program;return r.replaceWith(e),void r.stop()}const s=i.get("replaced"),a=i.get("imports");for(const e of a)n(r,e);const l=i.get("exports");l.length&&r.pushContainer("body",e.exportNamedDeclaration(null,l));const c=i.get("defaultExport");c&&r.pushContainer("body",e.exportDefaultDeclaration(c));const p=i.get("locals");for(const t of i.get("toReplace"))if(e.isMemberExpression(t.parentPath)){const n=t.parentPath.get("property"),r=e.isIdentifier(n)?n.node.name:e.isStringLiteral(n)?n.node.value:null,o=p.get(r);o?t.parentPath.replaceWith(e.clone(o)):(console.warn(t.buildCodeFrameError("Unable to remove usage of module.exports cleanly").message),t.replaceWith(e.objectExpression([])))}else e.isVariableDeclarator(t.parent)&&(r.scope.crawl(),1)&&!t.scope.getBinding(t.parent.id.name).referenced?t.parentPath.remove():e.isMemberExpression(t)&&o(t)&&p.get("default")?t.replaceWith(e.clone(p.get("default"))):s.has(t)||"left"===t.parentKey||"key"===t.parentKey||e.isVariableDeclarator(t.parentPath)||t.replaceWith(e.nullLiteral())}},AssignmentExpression:{exit(t,n){if(n.get("error")||!function(t){let n;try{n=t.getStatementParent()}catch(e){}return!n||n.parent&&e.isProgram(n.parent)}(t))return;const i=n.get("replaced"),s=n.get("exports"),a=n.get("locals"),l=t.get("left");if(e.isMemberExpression(l)||e.isIdentifier(l)){const c=l.get("object");let p,d,f=!1;r(l)||o(l)?(f=!0,p="_default",i.add(l)):(r(c)||o(c))&&(d=l.get("property"),p=e.isIdentifier(d)?d.node.name:e.isStringLiteral(d)?d.node.value:null);const g=t.get("right").resolve();if(p){if(f&&e.isObjectExpression(g)){let r={};for(const n of g.get("properties")){const o=n.get("value");if(!e.isIdentifier(o)){const r=t.scope.generateUidIdentifierBasedOnNode(n.node);e.isObjectMethod(n.node)?(g.getStatementParent().insertBefore(e.functionDeclaration(r,n.node.params,n.node.body)),n.replaceWith(e.objectProperty(e.clone(n.node.key),e.clone(r)))):(g.getStatementParent().insertBefore(e.variableDeclaration("const",[e.variableDeclarator(r,e.clone(o.node))])),o.replaceWith(e.clone(r)))}let i=n.node.value;r[n.node.key.name]=i,a.set(n.node.key.name,i),s.push(e.exportSpecifier(i,n.node.key))}t.parentPath.remove(),n.get("toReplace").push(g);const o=g.scope.getBinding(t.node.right.name);if(o)for(const t of o.referencePaths)e.isMemberExpression(t.container)&&t.parentPath.replaceWith(r[t.container.property.name]);return}p.match(/^[a-z_$][a-z0-9_$]*$/gi)||(console.error('Cannot transform CJS: invalid export name "'+p+'"'),n.set("error",!0));const r=t.scope.getBinding(p),o=!e.isValidIdentifier(p),i=f||r||o?t.scope.generateUidIdentifier(p):e.identifier(p);if(a.set(p,i),f||r||o||!t.parentPath.isStatement())t.scope.push({id:i}),f?n.set("defaultExport",i):s.push(e.exportSpecifier(i,e.identifier(p))),l.replaceWith(i);else{const n=e.exportNamedDeclaration(e.variableDeclaration("const",[e.variableDeclarator(e.identifier(p),e.clone(g.node))]),[]);t.parentPath.replaceWith(n)}}}}},CallExpression(t,n){if(n.get("error"))return;const r=n.get("imports"),o=n.get("locals"),s=t.node.callee;let a,l=[],c=!1,p=!1,d=!0;if(e.isIdentifier(s)&&"require"===s.name){if(!e.isStringLiteral(t.node.arguments[0]))return void console.warn("Dynamic require() usage.");const n=t.node.arguments[0].value;if(e.isMemberExpression(t.parent)&&"object"===t.key){const n=t.parent.property;let r=e.isIdentifier(n)?n.name:e.isStringLiteral(n)?n.value:null;r&&(a=t.scope.generateUidIdentifierBasedOnNode(n),l.push(e.importSpecifier(a,e.identifier(r))),t.parentPath.replaceWith(a),p=!0)}else if(e.isAssignmentExpression(t.parent)||e.isVariableDeclarator(t.parent)){if("right"!==t.key&&"init"!==t.key)return void console.warn("Deoptimizing: require() in left-hand side expression");const r=t.parentPath.get("init"===t.key?"id":"left");if(e.isIdentifier(r)&&e.isProgram(r.scope.block)&&!t.scope.checkBlockScopedCollisions(r.node)){a=o.has(n)?e.identifier(o.get(n)):r.node;const s=t.scope.getBinding(a.name);if(s&&s.constant&&s.referencePaths.every(i)){let n=new Map;for(const r of s.referencePaths)if(e.isMemberExpression(r.parent)){const o=r.parent.property,i=e.isStringLiteral(o)?o.value:o.name;let s=n.get(i);s||(s=t.scope.generateUidIdentifierBasedOnNode(o),n.set(i,s),l.push(e.importSpecifier(s,e.identifier(i)))),r.parentPath.replaceWith(s)}else{const o=r.parentPath.get("id"),i=[];for(const r of o.get("properties")){const{key:o,value:s}=r.node;let a=n.get(o.name);a||(a=t.scope.generateUidIdentifierBasedOnNode(s),n.set(o.name,a),l.push(e.importSpecifier(e.clone(a),e.clone(o)))),i.push(e.variableDeclarator(e.clone(s),e.clone(a)))}r.parentPath.parentPath.replaceWith(e.variableDeclaration("let",i))}p=!0}else c=!0;o.set(n,r.node.name),t.parentPath.remove(),p=!0}else{const i=o.has(n)&&e.identifier(o.get(n));i&&(d=!1,i.name===r.name&&(p=!0,t.parentPath.remove())),a=i||t.scope.generateUidIdentifierBasedOnNode(r.node||t.node.arguments[0])}if(e.isObjectPattern(r)){const n=[];for(const t of r.get("properties")){const{key:o,value:i}=t.node;if(e.isProgram(t.scope.block)&&!t.scope.checkBlockScopedCollisions(r.node))l.push(e.importSpecifier(e.clone(i),e.clone(o)));else{const r=t.scope.generateUidIdentifierBasedOnNode(i);l.push(e.importSpecifier(r,e.clone(o))),n.push(e.variableDeclarator(e.clone(i),r))}}n.length?t.parentPath.parentPath.replaceWith(e.variableDeclaration("let",n)):t.parentPath.parentPath.remove(),a=e.variableDeclaration("let",n),p=!0}}if(a=a||t.scope.generateUidIdentifier(),l.length||l.push(c?e.importDefaultSpecifier(a):e.importNamespaceSpecifier(a)),d){const t=e.importDeclaration(l,e.stringLiteral(n));r.push(t)}p||t.replaceWith(a)}}}}},u=({types:e})=>({name:"transform-umd-to-cjs",visitor:{Program:{enter(t,n){const r=t.get("body").filter(e.isStatement);if(1!==r.length)return;let o=r[0];if(!e.isExpressionStatement(o))return;if(o=o.get("expression"),e.isUnaryExpression(o)&&"!"===o.node.operator&&(o=o.get("argument")),!e.isCallExpression(o))return;const i=o,s=i.get("arguments").findIndex(e.isFunctionExpression);if(-1===s)return;const a=i.get("callee");if(!e.isFunctionExpression(a))return;const l=a.get("params."+s);let c;const p=l.scope.getBinding(l.node.name).referencePaths.find(t=>{if(!e.isCallExpression(t.parentPath))return!1;const n=t.parentPath.parentPath;if(!e.isAssignmentExpression(n))return!1;const r=n.get("left");return!(!e.isMemberExpression(r)||"module"!==r.node.object.name||"exports"!==r.node.property.name||(c=e.clone(r.node),0))}),d=i.get("arguments."+s+".params");let f=0;for(const n of p.parentPath.get("arguments")){let r=d[f++].node.name;t.scope.hasBinding(r)&&(r=t.scope.generateUidBasedOnNode(n.node.arguments[0]));const o=e.variableDeclaration("const",[e.variableDeclarator(e.identifier(r),e.clone(n.node))]);t.unshiftContainer("body",o)}const g=i.get("arguments."+s),u=g.get("body.body").find(e.isReturnStatement);u&&u.replaceWith(e.assignmentExpression("=",e.clone(c),e.clone(u.node.argument))),r[0].replaceWithMultiple(g.node.body.body.map(e.clone))}}}});module.exports=function(t,m={}){const h=!1!==m.module;return{plugins:[u,h&&!0===m.cjs&&g,[f,{loose:!0===m.loose}],d,p,c,l,a,s,i,o,!1!==m.webpack&&r,n,h&&e].filter(Boolean)}};
